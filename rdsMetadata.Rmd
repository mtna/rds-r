---
title: "Accessing Metadata with Rich Data Services"
output: html_document
---
<style>
  .col2 {
    columns: 2 300px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 300px; /* chrome, safari */
    -moz-columns: 2 300px;    /* firefox */
  }
</style>

##Overview
This document will explore using Metadata Technology North America's (MTNA) Rich Data Services (RDS) and how to integrate it with R. MTNA has written an RDS package for R that provides functions to efficiently access the data and metadata stored in a RDS server. This document serves as an example of how to access and use the two data functions provided, select and tabulate. In this example we will be using data from the American National Election Study in 1948. We have this stored on MTNA's public RDS server at {host}. 

```{r, echo=FALSE, results = 'hide'}
#install.packages("rds")
library("devtools", quietly = TRUE, warn.conflicts = FALSE)
library("roxygen2", quietly = TRUE, warn.conflicts = FALSE)
library(rrds, quietly = TRUE, warn.conflicts = FALSE)
library(sjPlot, quietly = TRUE, warn.conflicts = FALSE)
library(plotly, quietly = TRUE, warn.conflicts = FALSE)
```

##Data Dictionary
RDS contains variable metadata for every view that is accessible through the RDS library. The quality of this metadata depends on how the view has been managed and what the administrators have added, so this may be only include basic information like id, data type, and width, but it may also contain variable labels, descriptions, question information, and even classfication metadata.

To access the metadata for a view we will use the **get.variables** function, we will need to supply a base URL, collection, and view at the bare minimum. In this case lets assume that we want to take a look at all the variables that related to Harry S. Truman. To do that we will specify **cols=$truman** indicating that we want all the variables that have Truman in the name, label, description, or question text.

The variable metadata will be returned as a data.frame with the variable properties as the header and each variables values as a record. 
```{r, eval = TRUE, results = 'hide'}
anesVariables <- get.variables("http://localhost:8080/rds/api/catalog/","test","NES1948",cols="$truman")
table <- sjPlot::sjt.df(anesVariables, useViewer = F,describe=FALSE,encoding = "UTF-8", no.output=TRUE, altr.row.col=TRUE, show.rownames=FALSE)$knitr
```
`r table`

##Individual Variable Metadata
In the event that users need to access a single variables metadata instead of a group of variables the **get.variable** function can be used. Again we will need to know the base URL, collection, and view, as well as the variable ID. In this case we will specify the **var.id** parameter as V480014a.
```{r, eval = TRUE, results = 'hide'}
var <- get.variable("http://localhost:8080/rds/api/catalog/","test","NES1948",var.id="V480014a")
table <- sjPlot::sjt.df(var, useViewer = F,describe=FALSE,encoding = "UTF-8", no.output=TRUE, show.rownames=FALSE)$knitr
```
`r table`

##Individual Classification Metadata
Looking at the previously retrieved variable, V480014a, users may notice that this has a classification associated with it that has the id **V480014A**. If users want to view the classification they can use the classification ID to retreive the metadata as an **rds.classification** class. The rds.classification will contain three properties, the ID (character), the codes and their labels (data.frame), and an info section (data.frame) that will indicate information about the codes returned. 

Due to the fact that classifications can sometimes be very large (tens of thousands of codes) code limits can be placed on the classification to allow pagination through the classification if desired, the default code limit is 100. Codes can also be sorted in ASC or DESC order by their codes. 
```{r, eval = TRUE, results = 'hide'}
class <- get.classification("http://localhost:8080/rds/api/catalog/","test","NES1948",class.id=var$classification)
codes <- class@codes
asc.table <- sjPlot::sjt.df(codes, useViewer = F,describe=FALSE,encoding = "UTF-8", no.output=TRUE, altr.row.col=TRUE, show.rownames=FALSE)$knitr
class <- get.classification("http://localhost:8080/rds/api/catalog/","test","NES1948",class.id=var$classification,codeSort = "DESC")
codes <- class@codes
desc.table <- sjPlot::sjt.df(codes, useViewer = F,describe=FALSE,encoding = "UTF-8", no.output=TRUE, altr.row.col=TRUE, show.rownames=FALSE)$knitr
```
<div class="col2">
`r asc.table`
`r desc.table`
</div>

##Multiple Classifications
Multiple classifications can be retrieved as well using the **get.classifications** function. This will return a list of **rds.classification** objects. 
```{r, eval = TRUE, results = 'hide'}
classifications <- get.classifications("http://localhost:8080/rds/api/catalog/","test","NES1948")
```
<br/><br/><br/><br/>